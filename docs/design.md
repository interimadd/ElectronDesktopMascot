# Electronデスクトップマスコットアプリ 設計書

## 要件定義書

### 概要
Electronを使用したデスクトップマスコットアプリケーションを開発する。猫のキャラクターをデスクトップに表示し、ユーザーとテキストベースの会話ができる機能を提供する。

### 機能要件
1. **デスクトップマスコット表示**
   - 猫のキャラクターをデスクトップに表示する
   - 背景は透過させる
   - 指定されたCSS（https://codepen.io/carolineartz/pen/qBOEzQa）を使用してキャラクターを表示

2. **チャット機能**
   - ユーザーはキャラクターとテキストベースの会話ができる
   - 会話のバックエンドにはChatGPT APIを使用
   - キャラクターの上に吹き出しを表示してチャットを可視化

3. **アプリケーション動作**
   - Electronを使用してデスクトップアプリとして動作
   - 常駐アプリケーションとして動作し、タスクトレイからアクセス可能

### 非機能要件
1. **技術スタック**
   - プログラミング言語: TypeScript
   - フレームワーク: Electron
   - UI: HTML, CSS, JavaScript
   - バックエンド: ChatGPT API

2. **パフォーマンス**
   - 軽量で、システムリソースの消費を最小限に抑える
   - 応答性の高いUI

3. **セキュリティ**
   - ChatGPT APIキーの安全な管理

## 設計書

### 概略設計

#### アプリケーション構成
- **メインプロセス**: Electronのメインプロセスでアプリケーションのライフサイクルを管理
- **レンダラープロセス**: UIの表示と操作を担当
- **IPC通信**: メインプロセスとレンダラープロセス間の通信

#### 画面構成
1. **マスコット表示画面**
   - 透過背景の猫キャラクター
   - チャット用の吹き出し
   - テキスト入力フィールド

2. **設定画面**
   - ChatGPT APIキー設定
   - マスコットの表示設定（サイズ、位置など）

### 機能設計

#### マスコット表示機能
- 透過ウィンドウの作成
- CSSアニメーションを使用した猫キャラクターの表示
- ドラッグ可能なウィンドウ実装

#### チャット機能
- テキスト入力フィールドの実装
- ChatGPT APIとの通信処理
- 吹き出し表示の実装

#### システムトレイ機能
- システムトレイアイコンの表示
- コンテキストメニューの実装（設定画面表示、終了など）

### クラス構成

#### メインプロセス
- **App**: アプリケーション全体の管理
  - アプリケーションのライフサイクル管理
  - ウィンドウ管理
  - IPC通信の設定

- **ConfigManager**: 設定の管理
  - 設定の読み込み・保存
  - APIキーの管理

- **TrayManager**: システムトレイの管理
  - トレイアイコンの表示
  - コンテキストメニューの管理

#### レンダラープロセス
- **MascotRenderer**: マスコットの表示管理
  - CSSアニメーションの制御
  - マスコットの位置管理

- **ChatManager**: チャット機能の管理
  - テキスト入力の処理
  - ChatGPT APIとの通信
  - 会話履歴の管理

- **BubbleRenderer**: 吹き出しの表示管理
  - 吹き出しのレンダリング
  - テキストの表示・アニメーション

### データフロー
1. ユーザーがテキストを入力
2. ChatManagerがテキストを受け取り、ChatGPT APIにリクエスト
3. APIからのレスポンスをBubbleRendererに渡す
4. BubbleRendererが吹き出しを表示

### ファイル構成
```
/
├── docs/                  # ドキュメント
│   └── design.md          # 設計書
├── src/                   # ソースコード
│   ├── main/              # メインプロセス
│   │   ├── app.ts         # アプリケーションのエントリーポイント
│   │   ├── config.ts      # 設定管理
│   │   └── tray.ts        # システムトレイ管理
│   ├── renderer/          # レンダラープロセス
│   │   ├── mascot.ts      # マスコット表示管理
│   │   ├── chat.ts        # チャット機能
│   │   └── bubble.ts      # 吹き出し表示
│   ├── styles/            # スタイルシート
│   │   ├── mascot.css     # マスコットのスタイル
│   │   └── bubble.css     # 吹き出しのスタイル
│   ├── utils/             # ユーティリティ
│   │   ├── api.ts         # API通信
│   │   └── logger.ts      # ロギング
│   └── index.ts           # エントリーポイント
├── tests/                 # テストコード
│   ├── main/              # メインプロセスのテスト
│   ├── renderer/          # レンダラープロセスのテスト
│   └── utils/             # ユーティリティのテスト
├── package.json           # パッケージ設定
└── tsconfig.json          # TypeScript設定
```

### 技術的な検討事項
1. **ウィンドウの透過処理**
   - Electronの`transparent: true`オプションを使用
   - `frame: false`でフレームレスウィンドウを実現

2. **ChatGPT API連携**
   - OpenAI APIクライアントライブラリを使用
   - APIキーの安全な保存方法（electron-storeなどを使用）

3. **CSSアニメーション**
   - 提供されたCSSを適応し、Electron環境で動作するように調整
   - アニメーションのパフォーマンス最適化

4. **ドラッグ可能なウィンドウ**
   - カスタムドラッグ処理の実装
   - ウィンドウ位置の保存と復元